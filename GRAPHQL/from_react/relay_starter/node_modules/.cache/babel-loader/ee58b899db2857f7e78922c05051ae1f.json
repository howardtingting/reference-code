{"ast":null,"code":"/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar _require = require('../util/RelayConcreteNode'),\n    ACTOR_CHANGE = _require.ACTOR_CHANGE,\n    CLIENT_COMPONENT = _require.CLIENT_COMPONENT,\n    CLIENT_EXTENSION = _require.CLIENT_EXTENSION,\n    CONDITION = _require.CONDITION,\n    DEFER = _require.DEFER,\n    FLIGHT_FIELD = _require.FLIGHT_FIELD,\n    FRAGMENT_SPREAD = _require.FRAGMENT_SPREAD,\n    INLINE_FRAGMENT = _require.INLINE_FRAGMENT,\n    LINKED_FIELD = _require.LINKED_FIELD,\n    LINKED_HANDLE = _require.LINKED_HANDLE,\n    MODULE_IMPORT = _require.MODULE_IMPORT,\n    SCALAR_FIELD = _require.SCALAR_FIELD,\n    SCALAR_HANDLE = _require.SCALAR_HANDLE,\n    STREAM = _require.STREAM,\n    TYPE_DISCRIMINATOR = _require.TYPE_DISCRIMINATOR;\n\nvar warning = require(\"fbjs/lib/warning\"); // $FlowFixMe[method-unbinding] added when improving typing for this parameters\n\n\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar validateMutation = function validateMutation() {};\n\nif (process.env.NODE_ENV !== \"production\") {\n  var addFieldToDiff = function addFieldToDiff(path, diff, isScalar) {\n    var deepLoc = diff;\n    path.split('.').forEach(function (key, index, arr) {\n      if (deepLoc[key] == null) {\n        deepLoc[key] = {};\n      }\n\n      if (isScalar && index === arr.length - 1) {\n        deepLoc[key] = '<scalar>';\n      }\n\n      deepLoc = deepLoc[key];\n    });\n  };\n\n  validateMutation = function validateMutation(optimisticResponse, mutation, variables) {\n    var operationName = mutation.operation.name;\n    var context = {\n      path: 'ROOT',\n      visitedPaths: new Set(),\n      variables: variables || {},\n      missingDiff: {},\n      extraDiff: {},\n      moduleImportPaths: new Set()\n    };\n    validateSelections(optimisticResponse, mutation.operation.selections, context);\n    validateOptimisticResponse(optimisticResponse, context);\n    process.env.NODE_ENV !== \"production\" ? warning(context.missingDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please define fields for all of\\n%s', operationName, JSON.stringify(context.missingDiff.ROOT, null, 2)) : void 0;\n    process.env.NODE_ENV !== \"production\" ? warning(context.extraDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please remove all fields of\\n%s', operationName, JSON.stringify(context.extraDiff.ROOT, null, 2)) : void 0;\n  };\n\n  var validateSelections = function validateSelections(optimisticResponse, selections, context) {\n    selections.forEach(function (selection) {\n      return validateSelection(optimisticResponse, selection, context);\n    });\n  };\n\n  var validateSelection = function validateSelection(optimisticResponse, selection, context) {\n    switch (selection.kind) {\n      case CONDITION:\n        validateSelections(optimisticResponse, selection.selections, context);\n        return;\n\n      case CLIENT_COMPONENT:\n      case FRAGMENT_SPREAD:\n        validateSelections(optimisticResponse, selection.fragment.selections, context);\n        return;\n\n      case SCALAR_FIELD:\n      case LINKED_FIELD:\n      case FLIGHT_FIELD:\n        return validateField(optimisticResponse, selection, context);\n\n      case ACTOR_CHANGE:\n        return validateField(optimisticResponse, selection.linkedField, context);\n\n      case INLINE_FRAGMENT:\n        var type = selection.type;\n        var isConcreteType = selection.abstractKey == null;\n        validateAbstractKey(context, selection.abstractKey);\n        selection.selections.forEach(function (subselection) {\n          if (isConcreteType && optimisticResponse.__typename !== type) {\n            return;\n          }\n\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case CLIENT_EXTENSION:\n        selection.selections.forEach(function (subselection) {\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case MODULE_IMPORT:\n        return validateModuleImport(context);\n\n      case TYPE_DISCRIMINATOR:\n        return validateAbstractKey(context, selection.abstractKey);\n\n      case LINKED_HANDLE:\n      case SCALAR_HANDLE:\n      case DEFER:\n      case STREAM:\n        {\n          // TODO(T35864292) - Add missing validations for these types\n          return;\n        }\n\n      default:\n        selection;\n        return;\n    }\n  };\n\n  var validateModuleImport = function validateModuleImport(context) {\n    context.moduleImportPaths.add(context.path);\n  };\n\n  var validateAbstractKey = function validateAbstractKey(context, abstractKey) {\n    if (abstractKey != null) {\n      var path = \"\".concat(context.path, \".\").concat(abstractKey);\n      context.visitedPaths.add(path);\n    }\n  };\n\n  var validateField = function validateField(optimisticResponse, field, context) {\n    var fieldName = field.alias || field.name;\n    var path = \"\".concat(context.path, \".\").concat(fieldName);\n    context.visitedPaths.add(path);\n\n    switch (field.kind) {\n      case SCALAR_FIELD:\n        if (hasOwnProperty.call(optimisticResponse, fieldName) === false) {\n          addFieldToDiff(path, context.missingDiff, true);\n        }\n\n        return;\n\n      case LINKED_FIELD:\n        var selections = field.selections;\n\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        if (field.plural) {\n          if (Array.isArray(optimisticResponse[fieldName])) {\n            optimisticResponse[fieldName].forEach(function (r) {\n              if (r !== null) {\n                validateSelections(r, selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n                  path: path\n                }));\n              }\n            });\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        } else {\n          if (optimisticResponse[fieldName] instanceof Object) {\n            validateSelections(optimisticResponse[fieldName], selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n              path: path\n            }));\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        }\n\n      case FLIGHT_FIELD:\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        throw new Error('validateMutation: Flight fields are not compatible with ' + 'optimistic updates, as React does not have the component code ' + 'necessary to process new data on the client. Instead, you ' + 'should update your code to require a full refetch of the Flight ' + 'field so your UI can be updated.');\n    }\n  };\n\n  var validateOptimisticResponse = function validateOptimisticResponse(optimisticResponse, context) {\n    if (Array.isArray(optimisticResponse)) {\n      optimisticResponse.forEach(function (r) {\n        if (r instanceof Object) {\n          validateOptimisticResponse(r, context);\n        }\n      });\n      return;\n    }\n\n    Object.keys(optimisticResponse).forEach(function (key) {\n      var value = optimisticResponse[key];\n      var path = \"\".concat(context.path, \".\").concat(key); // if it's a module import path we don't have an ast so we cannot validate it\n\n      if (context.moduleImportPaths.has(path)) {\n        return;\n      }\n\n      if (!context.visitedPaths.has(path)) {\n        addFieldToDiff(path, context.extraDiff);\n        return;\n      }\n\n      if (value instanceof Object) {\n        validateOptimisticResponse(value, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n          path: path\n        }));\n      }\n    });\n  };\n}\n\nmodule.exports = validateMutation;","map":{"version":3,"sources":["/home/ting/Desktop/Projects/tutorials/GRAPHQL/from_react/relay_starter/node_modules/relay-runtime/lib/mutations/validateMutation.js"],"names":["_interopRequireDefault","require","_objectSpread2","_require","ACTOR_CHANGE","CLIENT_COMPONENT","CLIENT_EXTENSION","CONDITION","DEFER","FLIGHT_FIELD","FRAGMENT_SPREAD","INLINE_FRAGMENT","LINKED_FIELD","LINKED_HANDLE","MODULE_IMPORT","SCALAR_FIELD","SCALAR_HANDLE","STREAM","TYPE_DISCRIMINATOR","warning","hasOwnProperty","Object","prototype","validateMutation","process","env","NODE_ENV","addFieldToDiff","path","diff","isScalar","deepLoc","split","forEach","key","index","arr","length","optimisticResponse","mutation","variables","operationName","operation","name","context","visitedPaths","Set","missingDiff","extraDiff","moduleImportPaths","validateSelections","selections","validateOptimisticResponse","ROOT","JSON","stringify","selection","validateSelection","kind","fragment","validateField","linkedField","type","isConcreteType","abstractKey","validateAbstractKey","subselection","__typename","validateModuleImport","add","concat","field","fieldName","alias","call","undefined","plural","Array","isArray","r","Error","keys","value","has","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar _require = require('../util/RelayConcreteNode'),\n    ACTOR_CHANGE = _require.ACTOR_CHANGE,\n    CLIENT_COMPONENT = _require.CLIENT_COMPONENT,\n    CLIENT_EXTENSION = _require.CLIENT_EXTENSION,\n    CONDITION = _require.CONDITION,\n    DEFER = _require.DEFER,\n    FLIGHT_FIELD = _require.FLIGHT_FIELD,\n    FRAGMENT_SPREAD = _require.FRAGMENT_SPREAD,\n    INLINE_FRAGMENT = _require.INLINE_FRAGMENT,\n    LINKED_FIELD = _require.LINKED_FIELD,\n    LINKED_HANDLE = _require.LINKED_HANDLE,\n    MODULE_IMPORT = _require.MODULE_IMPORT,\n    SCALAR_FIELD = _require.SCALAR_FIELD,\n    SCALAR_HANDLE = _require.SCALAR_HANDLE,\n    STREAM = _require.STREAM,\n    TYPE_DISCRIMINATOR = _require.TYPE_DISCRIMINATOR;\n\nvar warning = require(\"fbjs/lib/warning\");\n\n// $FlowFixMe[method-unbinding] added when improving typing for this parameters\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar validateMutation = function validateMutation() {};\n\nif (process.env.NODE_ENV !== \"production\") {\n  var addFieldToDiff = function addFieldToDiff(path, diff, isScalar) {\n    var deepLoc = diff;\n    path.split('.').forEach(function (key, index, arr) {\n      if (deepLoc[key] == null) {\n        deepLoc[key] = {};\n      }\n\n      if (isScalar && index === arr.length - 1) {\n        deepLoc[key] = '<scalar>';\n      }\n\n      deepLoc = deepLoc[key];\n    });\n  };\n\n  validateMutation = function validateMutation(optimisticResponse, mutation, variables) {\n    var operationName = mutation.operation.name;\n    var context = {\n      path: 'ROOT',\n      visitedPaths: new Set(),\n      variables: variables || {},\n      missingDiff: {},\n      extraDiff: {},\n      moduleImportPaths: new Set()\n    };\n    validateSelections(optimisticResponse, mutation.operation.selections, context);\n    validateOptimisticResponse(optimisticResponse, context);\n    process.env.NODE_ENV !== \"production\" ? warning(context.missingDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please define fields for all of\\n%s', operationName, JSON.stringify(context.missingDiff.ROOT, null, 2)) : void 0;\n    process.env.NODE_ENV !== \"production\" ? warning(context.extraDiff.ROOT == null, 'Expected `optimisticResponse` to match structure of server response for mutation `%s`, please remove all fields of\\n%s', operationName, JSON.stringify(context.extraDiff.ROOT, null, 2)) : void 0;\n  };\n\n  var validateSelections = function validateSelections(optimisticResponse, selections, context) {\n    selections.forEach(function (selection) {\n      return validateSelection(optimisticResponse, selection, context);\n    });\n  };\n\n  var validateSelection = function validateSelection(optimisticResponse, selection, context) {\n    switch (selection.kind) {\n      case CONDITION:\n        validateSelections(optimisticResponse, selection.selections, context);\n        return;\n\n      case CLIENT_COMPONENT:\n      case FRAGMENT_SPREAD:\n        validateSelections(optimisticResponse, selection.fragment.selections, context);\n        return;\n\n      case SCALAR_FIELD:\n      case LINKED_FIELD:\n      case FLIGHT_FIELD:\n        return validateField(optimisticResponse, selection, context);\n\n      case ACTOR_CHANGE:\n        return validateField(optimisticResponse, selection.linkedField, context);\n\n      case INLINE_FRAGMENT:\n        var type = selection.type;\n        var isConcreteType = selection.abstractKey == null;\n        validateAbstractKey(context, selection.abstractKey);\n        selection.selections.forEach(function (subselection) {\n          if (isConcreteType && optimisticResponse.__typename !== type) {\n            return;\n          }\n\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case CLIENT_EXTENSION:\n        selection.selections.forEach(function (subselection) {\n          validateSelection(optimisticResponse, subselection, context);\n        });\n        return;\n\n      case MODULE_IMPORT:\n        return validateModuleImport(context);\n\n      case TYPE_DISCRIMINATOR:\n        return validateAbstractKey(context, selection.abstractKey);\n\n      case LINKED_HANDLE:\n      case SCALAR_HANDLE:\n      case DEFER:\n      case STREAM:\n        {\n          // TODO(T35864292) - Add missing validations for these types\n          return;\n        }\n\n      default:\n        selection;\n        return;\n    }\n  };\n\n  var validateModuleImport = function validateModuleImport(context) {\n    context.moduleImportPaths.add(context.path);\n  };\n\n  var validateAbstractKey = function validateAbstractKey(context, abstractKey) {\n    if (abstractKey != null) {\n      var path = \"\".concat(context.path, \".\").concat(abstractKey);\n      context.visitedPaths.add(path);\n    }\n  };\n\n  var validateField = function validateField(optimisticResponse, field, context) {\n    var fieldName = field.alias || field.name;\n    var path = \"\".concat(context.path, \".\").concat(fieldName);\n    context.visitedPaths.add(path);\n\n    switch (field.kind) {\n      case SCALAR_FIELD:\n        if (hasOwnProperty.call(optimisticResponse, fieldName) === false) {\n          addFieldToDiff(path, context.missingDiff, true);\n        }\n\n        return;\n\n      case LINKED_FIELD:\n        var selections = field.selections;\n\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        if (field.plural) {\n          if (Array.isArray(optimisticResponse[fieldName])) {\n            optimisticResponse[fieldName].forEach(function (r) {\n              if (r !== null) {\n                validateSelections(r, selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n                  path: path\n                }));\n              }\n            });\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        } else {\n          if (optimisticResponse[fieldName] instanceof Object) {\n            validateSelections(optimisticResponse[fieldName], selections, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n              path: path\n            }));\n            return;\n          } else {\n            addFieldToDiff(path, context.missingDiff);\n            return;\n          }\n        }\n\n      case FLIGHT_FIELD:\n        if (optimisticResponse[fieldName] === null || hasOwnProperty.call(optimisticResponse, fieldName) && optimisticResponse[fieldName] === undefined) {\n          return;\n        }\n\n        throw new Error('validateMutation: Flight fields are not compatible with ' + 'optimistic updates, as React does not have the component code ' + 'necessary to process new data on the client. Instead, you ' + 'should update your code to require a full refetch of the Flight ' + 'field so your UI can be updated.');\n    }\n  };\n\n  var validateOptimisticResponse = function validateOptimisticResponse(optimisticResponse, context) {\n    if (Array.isArray(optimisticResponse)) {\n      optimisticResponse.forEach(function (r) {\n        if (r instanceof Object) {\n          validateOptimisticResponse(r, context);\n        }\n      });\n      return;\n    }\n\n    Object.keys(optimisticResponse).forEach(function (key) {\n      var value = optimisticResponse[key];\n      var path = \"\".concat(context.path, \".\").concat(key); // if it's a module import path we don't have an ast so we cannot validate it\n\n      if (context.moduleImportPaths.has(path)) {\n        return;\n      }\n\n      if (!context.visitedPaths.has(path)) {\n        addFieldToDiff(path, context.extraDiff);\n        return;\n      }\n\n      if (value instanceof Object) {\n        validateOptimisticResponse(value, (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, context), {}, {\n          path: path\n        }));\n      }\n    });\n  };\n}\n\nmodule.exports = validateMutation;"]},"metadata":{},"sourceType":"script"}