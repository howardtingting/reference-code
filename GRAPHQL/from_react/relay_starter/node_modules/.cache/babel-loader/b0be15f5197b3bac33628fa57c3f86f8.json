{"ast":null,"code":"/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @emails oncall+relay\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar useFetchTrackingRef = require('./useFetchTrackingRef');\n\nvar useIsMountedRef = require('./useIsMountedRef');\n\nvar useIsOperationNodeActive = require('./useIsOperationNodeActive');\n\nvar useRelayEnvironment = require('./useRelayEnvironment');\n\nvar invariant = require('invariant');\n\nvar _require = require('react'),\n    useCallback = _require.useCallback,\n    useEffect = _require.useEffect,\n    useState = _require.useState;\n\nvar _require2 = require('relay-runtime'),\n    ConnectionInterface = _require2.ConnectionInterface,\n    fetchQuery = _require2.__internal.fetchQuery,\n    createOperationDescriptor = _require2.createOperationDescriptor,\n    getPaginationVariables = _require2.getPaginationVariables,\n    getSelector = _require2.getSelector,\n    getValueAtPath = _require2.getValueAtPath;\n\nvar warning = require(\"fbjs/lib/warning\");\n\nfunction useLoadMoreFunction(args) {\n  var direction = args.direction,\n      fragmentNode = args.fragmentNode,\n      fragmentRef = args.fragmentRef,\n      fragmentIdentifier = args.fragmentIdentifier,\n      fragmentData = args.fragmentData,\n      connectionPathInFragmentData = args.connectionPathInFragmentData,\n      paginationRequest = args.paginationRequest,\n      paginationMetadata = args.paginationMetadata,\n      componentDisplayName = args.componentDisplayName,\n      observer = args.observer,\n      onReset = args.onReset,\n      identifierField = args.identifierField;\n  var environment = useRelayEnvironment();\n\n  var _useFetchTrackingRef = useFetchTrackingRef(),\n      isFetchingRef = _useFetchTrackingRef.isFetchingRef,\n      startFetch = _useFetchTrackingRef.startFetch,\n      disposeFetch = _useFetchTrackingRef.disposeFetch,\n      completeFetch = _useFetchTrackingRef.completeFetch;\n\n  var identifierValue = identifierField != null && fragmentData != null && typeof fragmentData === 'object' ? fragmentData[identifierField] : null;\n  var isMountedRef = useIsMountedRef();\n\n  var _useState = useState(environment),\n      mirroredEnvironment = _useState[0],\n      setMirroredEnvironment = _useState[1];\n\n  var _useState2 = useState(fragmentIdentifier),\n      mirroredFragmentIdentifier = _useState2[0],\n      setMirroredFragmentIdentifier = _useState2[1];\n\n  var isParentQueryActive = useIsOperationNodeActive(fragmentNode, fragmentRef);\n  var shouldReset = environment !== mirroredEnvironment || fragmentIdentifier !== mirroredFragmentIdentifier;\n\n  if (shouldReset) {\n    disposeFetch();\n    onReset();\n    setMirroredEnvironment(environment);\n    setMirroredFragmentIdentifier(fragmentIdentifier);\n  }\n\n  var _getConnectionState = getConnectionState(direction, fragmentNode, fragmentData, connectionPathInFragmentData),\n      cursor = _getConnectionState.cursor,\n      hasMore = _getConnectionState.hasMore; // Dispose of pagination requests in flight when unmounting\n\n\n  useEffect(function () {\n    return function () {\n      disposeFetch();\n    };\n  }, [disposeFetch]);\n  var loadMore = useCallback(function (count, options) {\n    // TODO(T41131846): Fetch/Caching policies for loadMore\n    var onComplete = options === null || options === void 0 ? void 0 : options.onComplete;\n\n    if (isMountedRef.current !== true) {\n      // Bail out and warn if we're trying to paginate after the component\n      // has unmounted\n      process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Unexpected fetch on unmounted component for fragment ' + '`%s` in `%s`. It looks like some instances of your component are ' + 'still trying to fetch data but they already unmounted. ' + 'Please make sure you clear all timers, intervals, ' + 'async calls, etc that may trigger a fetch.', fragmentNode.name, componentDisplayName) : void 0;\n      return {\n        dispose: function dispose() {}\n      };\n    }\n\n    var fragmentSelector = getSelector(fragmentNode, fragmentRef);\n\n    if (isFetchingRef.current === true || fragmentData == null || isParentQueryActive) {\n      if (fragmentSelector == null) {\n        process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Unexpected fetch while using a null fragment ref ' + 'for fragment `%s` in `%s`. When fetching more items, we expect ' + \"initial fragment data to be non-null. Please make sure you're \" + 'passing a valid fragment ref to `%s` before paginating.', fragmentNode.name, componentDisplayName, componentDisplayName) : void 0;\n      }\n\n      if (onComplete) {\n        onComplete(null);\n      }\n\n      return {\n        dispose: function dispose() {}\n      };\n    }\n\n    !(fragmentSelector != null && fragmentSelector.kind !== 'PluralReaderSelector') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected to be able to find a non-plural fragment owner for ' + \"fragment `%s` when using `%s`. If you're seeing this, \" + 'this is likely a bug in Relay.', fragmentNode.name, componentDisplayName) : invariant(false) : void 0;\n    var parentVariables = fragmentSelector.owner.variables;\n    var fragmentVariables = fragmentSelector.variables;\n    var extraVariables = options === null || options === void 0 ? void 0 : options.UNSTABLE_extraVariables;\n    var baseVariables = (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, parentVariables), fragmentVariables);\n    var paginationVariables = getPaginationVariables(direction, count, cursor, baseVariables, (0, _objectSpread2[\"default\"])({}, extraVariables), paginationMetadata); // If the query needs an identifier value ('id' or similar) and one\n    // was not explicitly provided, read it from the fragment data.\n\n    if (identifierField != null) {\n      // @refetchable fragments are guaranteed to have an `id` selection\n      // if the type is Node, implements Node, or is @fetchable. Double-check\n      // that there actually is a value at runtime.\n      if (typeof identifierValue !== 'string') {\n        process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Expected result to have a string  ' + '`%s` in order to refetch, got `%s`.', identifierField, identifierValue) : void 0;\n      }\n\n      paginationVariables.id = identifierValue;\n    }\n\n    var paginationQuery = createOperationDescriptor(paginationRequest, paginationVariables, {\n      force: true\n    });\n    fetchQuery(environment, paginationQuery).subscribe((0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, observer), {}, {\n      start: function start(subscription) {\n        startFetch(subscription);\n        observer.start && observer.start(subscription);\n      },\n      complete: function complete() {\n        completeFetch();\n        observer.complete && observer.complete();\n        onComplete && onComplete(null);\n      },\n      error: function error(_error) {\n        completeFetch();\n        observer.error && observer.error(_error);\n        onComplete && onComplete(_error);\n      }\n    }));\n    return {\n      dispose: disposeFetch\n    };\n  }, // NOTE: We disable react-hooks-deps warning because all values\n  // inside paginationMetadata are static\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  [environment, identifierValue, direction, cursor, startFetch, disposeFetch, completeFetch, isFetchingRef, isParentQueryActive, fragmentData, fragmentNode.name, fragmentRef, componentDisplayName]);\n  return [loadMore, hasMore, disposeFetch];\n}\n\nfunction getConnectionState(direction, fragmentNode, fragmentData, connectionPathInFragmentData) {\n  var _pageInfo$END_CURSOR, _pageInfo$START_CURSO;\n\n  var _ConnectionInterface$ = ConnectionInterface.get(),\n      EDGES = _ConnectionInterface$.EDGES,\n      PAGE_INFO = _ConnectionInterface$.PAGE_INFO,\n      HAS_NEXT_PAGE = _ConnectionInterface$.HAS_NEXT_PAGE,\n      HAS_PREV_PAGE = _ConnectionInterface$.HAS_PREV_PAGE,\n      END_CURSOR = _ConnectionInterface$.END_CURSOR,\n      START_CURSOR = _ConnectionInterface$.START_CURSOR;\n\n  var connection = getValueAtPath(fragmentData, connectionPathInFragmentData);\n\n  if (connection == null) {\n    return {\n      cursor: null,\n      hasMore: false\n    };\n  }\n\n  !(typeof connection === 'object') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected connection in fragment `%s` to have been `null`, or ' + 'a plain object with %s and %s properties. Instead got `%s`.', fragmentNode.name, EDGES, PAGE_INFO, connection) : invariant(false) : void 0;\n  var edges = connection[EDGES];\n  var pageInfo = connection[PAGE_INFO];\n\n  if (edges == null || pageInfo == null) {\n    return {\n      cursor: null,\n      hasMore: false\n    };\n  }\n\n  !Array.isArray(edges) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected connection in fragment `%s` to have a plural `%s` field. ' + 'Instead got `%s`.', fragmentNode.name, EDGES, edges) : invariant(false) : void 0;\n  !(typeof pageInfo === 'object') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected connection in fragment `%s` to have a `%s` field. ' + 'Instead got `%s`.', fragmentNode.name, PAGE_INFO, pageInfo) : invariant(false) : void 0;\n  var cursor = direction === 'forward' ? (_pageInfo$END_CURSOR = pageInfo[END_CURSOR]) !== null && _pageInfo$END_CURSOR !== void 0 ? _pageInfo$END_CURSOR : null : (_pageInfo$START_CURSO = pageInfo[START_CURSOR]) !== null && _pageInfo$START_CURSO !== void 0 ? _pageInfo$START_CURSO : null;\n  !(cursor === null || typeof cursor === 'string') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected page info for connection in fragment `%s` to have a ' + 'valid `%s`. Instead got `%s`.', fragmentNode.name, START_CURSOR, cursor) : invariant(false) : void 0;\n  var hasMore;\n\n  if (direction === 'forward') {\n    hasMore = cursor != null && pageInfo[HAS_NEXT_PAGE] === true;\n  } else {\n    hasMore = cursor != null && pageInfo[HAS_PREV_PAGE] === true;\n  }\n\n  return {\n    cursor: cursor,\n    hasMore: hasMore\n  };\n}\n\nmodule.exports = useLoadMoreFunction;","map":{"version":3,"sources":["/home/ting/Desktop/Projects/tutorials/GRAPHQL/from_react/relay_starter/node_modules/react-relay/lib/relay-hooks/useLoadMoreFunction.js"],"names":["_interopRequireDefault","require","_objectSpread2","useFetchTrackingRef","useIsMountedRef","useIsOperationNodeActive","useRelayEnvironment","invariant","_require","useCallback","useEffect","useState","_require2","ConnectionInterface","fetchQuery","__internal","createOperationDescriptor","getPaginationVariables","getSelector","getValueAtPath","warning","useLoadMoreFunction","args","direction","fragmentNode","fragmentRef","fragmentIdentifier","fragmentData","connectionPathInFragmentData","paginationRequest","paginationMetadata","componentDisplayName","observer","onReset","identifierField","environment","_useFetchTrackingRef","isFetchingRef","startFetch","disposeFetch","completeFetch","identifierValue","isMountedRef","_useState","mirroredEnvironment","setMirroredEnvironment","_useState2","mirroredFragmentIdentifier","setMirroredFragmentIdentifier","isParentQueryActive","shouldReset","_getConnectionState","getConnectionState","cursor","hasMore","loadMore","count","options","onComplete","current","process","env","NODE_ENV","name","dispose","fragmentSelector","kind","parentVariables","owner","variables","fragmentVariables","extraVariables","UNSTABLE_extraVariables","baseVariables","paginationVariables","id","paginationQuery","force","subscribe","start","subscription","complete","error","_error","_pageInfo$END_CURSOR","_pageInfo$START_CURSO","_ConnectionInterface$","get","EDGES","PAGE_INFO","HAS_NEXT_PAGE","HAS_PREV_PAGE","END_CURSOR","START_CURSOR","connection","edges","pageInfo","Array","isArray","module","exports"],"mappings":"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","sourcesContent":["/**\n * Copyright (c) Meta Platforms, Inc. and affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n *\n * @emails oncall+relay\n * \n * @format\n */\n// flowlint ambiguous-object-type:error\n'use strict';\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nvar _objectSpread2 = _interopRequireDefault(require(\"@babel/runtime/helpers/objectSpread2\"));\n\nvar useFetchTrackingRef = require('./useFetchTrackingRef');\n\nvar useIsMountedRef = require('./useIsMountedRef');\n\nvar useIsOperationNodeActive = require('./useIsOperationNodeActive');\n\nvar useRelayEnvironment = require('./useRelayEnvironment');\n\nvar invariant = require('invariant');\n\nvar _require = require('react'),\n    useCallback = _require.useCallback,\n    useEffect = _require.useEffect,\n    useState = _require.useState;\n\nvar _require2 = require('relay-runtime'),\n    ConnectionInterface = _require2.ConnectionInterface,\n    fetchQuery = _require2.__internal.fetchQuery,\n    createOperationDescriptor = _require2.createOperationDescriptor,\n    getPaginationVariables = _require2.getPaginationVariables,\n    getSelector = _require2.getSelector,\n    getValueAtPath = _require2.getValueAtPath;\n\nvar warning = require(\"fbjs/lib/warning\");\n\nfunction useLoadMoreFunction(args) {\n  var direction = args.direction,\n      fragmentNode = args.fragmentNode,\n      fragmentRef = args.fragmentRef,\n      fragmentIdentifier = args.fragmentIdentifier,\n      fragmentData = args.fragmentData,\n      connectionPathInFragmentData = args.connectionPathInFragmentData,\n      paginationRequest = args.paginationRequest,\n      paginationMetadata = args.paginationMetadata,\n      componentDisplayName = args.componentDisplayName,\n      observer = args.observer,\n      onReset = args.onReset,\n      identifierField = args.identifierField;\n  var environment = useRelayEnvironment();\n\n  var _useFetchTrackingRef = useFetchTrackingRef(),\n      isFetchingRef = _useFetchTrackingRef.isFetchingRef,\n      startFetch = _useFetchTrackingRef.startFetch,\n      disposeFetch = _useFetchTrackingRef.disposeFetch,\n      completeFetch = _useFetchTrackingRef.completeFetch;\n\n  var identifierValue = identifierField != null && fragmentData != null && typeof fragmentData === 'object' ? fragmentData[identifierField] : null;\n  var isMountedRef = useIsMountedRef();\n\n  var _useState = useState(environment),\n      mirroredEnvironment = _useState[0],\n      setMirroredEnvironment = _useState[1];\n\n  var _useState2 = useState(fragmentIdentifier),\n      mirroredFragmentIdentifier = _useState2[0],\n      setMirroredFragmentIdentifier = _useState2[1];\n\n  var isParentQueryActive = useIsOperationNodeActive(fragmentNode, fragmentRef);\n  var shouldReset = environment !== mirroredEnvironment || fragmentIdentifier !== mirroredFragmentIdentifier;\n\n  if (shouldReset) {\n    disposeFetch();\n    onReset();\n    setMirroredEnvironment(environment);\n    setMirroredFragmentIdentifier(fragmentIdentifier);\n  }\n\n  var _getConnectionState = getConnectionState(direction, fragmentNode, fragmentData, connectionPathInFragmentData),\n      cursor = _getConnectionState.cursor,\n      hasMore = _getConnectionState.hasMore; // Dispose of pagination requests in flight when unmounting\n\n\n  useEffect(function () {\n    return function () {\n      disposeFetch();\n    };\n  }, [disposeFetch]);\n  var loadMore = useCallback(function (count, options) {\n    // TODO(T41131846): Fetch/Caching policies for loadMore\n    var onComplete = options === null || options === void 0 ? void 0 : options.onComplete;\n\n    if (isMountedRef.current !== true) {\n      // Bail out and warn if we're trying to paginate after the component\n      // has unmounted\n      process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Unexpected fetch on unmounted component for fragment ' + '`%s` in `%s`. It looks like some instances of your component are ' + 'still trying to fetch data but they already unmounted. ' + 'Please make sure you clear all timers, intervals, ' + 'async calls, etc that may trigger a fetch.', fragmentNode.name, componentDisplayName) : void 0;\n      return {\n        dispose: function dispose() {}\n      };\n    }\n\n    var fragmentSelector = getSelector(fragmentNode, fragmentRef);\n\n    if (isFetchingRef.current === true || fragmentData == null || isParentQueryActive) {\n      if (fragmentSelector == null) {\n        process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Unexpected fetch while using a null fragment ref ' + 'for fragment `%s` in `%s`. When fetching more items, we expect ' + \"initial fragment data to be non-null. Please make sure you're \" + 'passing a valid fragment ref to `%s` before paginating.', fragmentNode.name, componentDisplayName, componentDisplayName) : void 0;\n      }\n\n      if (onComplete) {\n        onComplete(null);\n      }\n\n      return {\n        dispose: function dispose() {}\n      };\n    }\n\n    !(fragmentSelector != null && fragmentSelector.kind !== 'PluralReaderSelector') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected to be able to find a non-plural fragment owner for ' + \"fragment `%s` when using `%s`. If you're seeing this, \" + 'this is likely a bug in Relay.', fragmentNode.name, componentDisplayName) : invariant(false) : void 0;\n    var parentVariables = fragmentSelector.owner.variables;\n    var fragmentVariables = fragmentSelector.variables;\n    var extraVariables = options === null || options === void 0 ? void 0 : options.UNSTABLE_extraVariables;\n    var baseVariables = (0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, parentVariables), fragmentVariables);\n    var paginationVariables = getPaginationVariables(direction, count, cursor, baseVariables, (0, _objectSpread2[\"default\"])({}, extraVariables), paginationMetadata); // If the query needs an identifier value ('id' or similar) and one\n    // was not explicitly provided, read it from the fragment data.\n\n    if (identifierField != null) {\n      // @refetchable fragments are guaranteed to have an `id` selection\n      // if the type is Node, implements Node, or is @fetchable. Double-check\n      // that there actually is a value at runtime.\n      if (typeof identifierValue !== 'string') {\n        process.env.NODE_ENV !== \"production\" ? warning(false, 'Relay: Expected result to have a string  ' + '`%s` in order to refetch, got `%s`.', identifierField, identifierValue) : void 0;\n      }\n\n      paginationVariables.id = identifierValue;\n    }\n\n    var paginationQuery = createOperationDescriptor(paginationRequest, paginationVariables, {\n      force: true\n    });\n    fetchQuery(environment, paginationQuery).subscribe((0, _objectSpread2[\"default\"])((0, _objectSpread2[\"default\"])({}, observer), {}, {\n      start: function start(subscription) {\n        startFetch(subscription);\n        observer.start && observer.start(subscription);\n      },\n      complete: function complete() {\n        completeFetch();\n        observer.complete && observer.complete();\n        onComplete && onComplete(null);\n      },\n      error: function error(_error) {\n        completeFetch();\n        observer.error && observer.error(_error);\n        onComplete && onComplete(_error);\n      }\n    }));\n    return {\n      dispose: disposeFetch\n    };\n  }, // NOTE: We disable react-hooks-deps warning because all values\n  // inside paginationMetadata are static\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  [environment, identifierValue, direction, cursor, startFetch, disposeFetch, completeFetch, isFetchingRef, isParentQueryActive, fragmentData, fragmentNode.name, fragmentRef, componentDisplayName]);\n  return [loadMore, hasMore, disposeFetch];\n}\n\nfunction getConnectionState(direction, fragmentNode, fragmentData, connectionPathInFragmentData) {\n  var _pageInfo$END_CURSOR, _pageInfo$START_CURSO;\n\n  var _ConnectionInterface$ = ConnectionInterface.get(),\n      EDGES = _ConnectionInterface$.EDGES,\n      PAGE_INFO = _ConnectionInterface$.PAGE_INFO,\n      HAS_NEXT_PAGE = _ConnectionInterface$.HAS_NEXT_PAGE,\n      HAS_PREV_PAGE = _ConnectionInterface$.HAS_PREV_PAGE,\n      END_CURSOR = _ConnectionInterface$.END_CURSOR,\n      START_CURSOR = _ConnectionInterface$.START_CURSOR;\n\n  var connection = getValueAtPath(fragmentData, connectionPathInFragmentData);\n\n  if (connection == null) {\n    return {\n      cursor: null,\n      hasMore: false\n    };\n  }\n\n  !(typeof connection === 'object') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected connection in fragment `%s` to have been `null`, or ' + 'a plain object with %s and %s properties. Instead got `%s`.', fragmentNode.name, EDGES, PAGE_INFO, connection) : invariant(false) : void 0;\n  var edges = connection[EDGES];\n  var pageInfo = connection[PAGE_INFO];\n\n  if (edges == null || pageInfo == null) {\n    return {\n      cursor: null,\n      hasMore: false\n    };\n  }\n\n  !Array.isArray(edges) ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected connection in fragment `%s` to have a plural `%s` field. ' + 'Instead got `%s`.', fragmentNode.name, EDGES, edges) : invariant(false) : void 0;\n  !(typeof pageInfo === 'object') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected connection in fragment `%s` to have a `%s` field. ' + 'Instead got `%s`.', fragmentNode.name, PAGE_INFO, pageInfo) : invariant(false) : void 0;\n  var cursor = direction === 'forward' ? (_pageInfo$END_CURSOR = pageInfo[END_CURSOR]) !== null && _pageInfo$END_CURSOR !== void 0 ? _pageInfo$END_CURSOR : null : (_pageInfo$START_CURSO = pageInfo[START_CURSOR]) !== null && _pageInfo$START_CURSO !== void 0 ? _pageInfo$START_CURSO : null;\n  !(cursor === null || typeof cursor === 'string') ? process.env.NODE_ENV !== \"production\" ? invariant(false, 'Relay: Expected page info for connection in fragment `%s` to have a ' + 'valid `%s`. Instead got `%s`.', fragmentNode.name, START_CURSOR, cursor) : invariant(false) : void 0;\n  var hasMore;\n\n  if (direction === 'forward') {\n    hasMore = cursor != null && pageInfo[HAS_NEXT_PAGE] === true;\n  } else {\n    hasMore = cursor != null && pageInfo[HAS_PREV_PAGE] === true;\n  }\n\n  return {\n    cursor: cursor,\n    hasMore: hasMore\n  };\n}\n\nmodule.exports = useLoadMoreFunction;"]},"metadata":{},"sourceType":"script"}